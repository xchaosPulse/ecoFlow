<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุณุงูุงูู ูพุงุงูพุง ฺฉุงูุง ูุญู (ููุจุงุฏูู)</title>
    
    <!-- Social Media Metadata (Thumbnail/Preview) -->
    <meta property="og:title" content="ููุจุงุฏูู: ุณุงูุงูู ูพุงุงูพุง ฺฉุงูุง ูุญู">
    <meta property="og:description" content="ุญูุธ ูุฏุฑุช ุฎุฑุฏ ุจุง ฺฉุงูุง ูุงูุน. ุณุณุชู ุงุนุชุจุงุฑ ฺฉุงูุง ูุญู ุฑุง ุดุจูโุณุงุฒ ฺฉูุฏ.">
    <!-- Changed placeholder image for better preview -->
    <meta property="og:image" content="https://placehold.co/1200x630/c59a53/ffffff?text=Mobadeleh+Barter+System"> 
    <meta property="og:url" content="https://your-app-url.com/mobadeleh">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts: Vazirmatn for Persian -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#fcfbf9',
                            100: '#f6f1ea',
                            200: '#ede4d3',
                            300: '#e0cea9',
                            400: '#d1b278',
                            500: '#c59a53',
                            600: '#aa7e40',
                            700: '#896136',
                            800: '#714e32',
                            900: '#5e412d',
                        },
                        accent: {
                            green: '#4ade80', // Growth/Profit
                            red: '#f87171',   // Inflation/Loss
                            blue: '#60a5fa',  // Cash Sale
                        }
                    },
                    fontFamily: {
                        sans: ['Vazirmatn', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Styles for Chart Containers */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 300px;
            max-height: 400px;
        }
        
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Smooth Transition for Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        body {
            background-color: #f6f1ea; /* brand-100 */
            color: #5e412d; /* brand-900 */
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #ede4d3; 
        }
        ::-webkit-scrollbar-thumb {
            background: #aa7e40; 
            border-radius: 4px;
        }
    </style>
</head>
<body class="font-sans antialiased min-h-screen flex flex-col">

    <!-- Navigation -->
    <nav class="bg-brand-800 text-brand-50 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-black tracking-wider">ููุจุงุฏูู</span>
                    <span class="mr-2 text-brand-300 text-sm hidden sm:block">| ุณุงูุงูู ูพุงุงูพุง ูุญู</span>
                </div>
                <div class="hidden md:block">
                    <div class="flex items-baseline space-x-4 space-x-reverse">
                        <button onclick="switchTab('home')" class="nav-btn px-3 py-2 rounded-md text-sm font-medium hover:bg-brand-700 transition">ุฎุงูู</button>
                        <button onclick="switchTab('simulation')" class="nav-btn px-3 py-2 rounded-md text-sm font-medium hover:bg-brand-700 transition">ุดุจูโุณุงุฒ ฺฉู ูพูู</button>
                        <button onclick="switchTab('market')" class="nav-btn px-3 py-2 rounded-md text-sm font-medium hover:bg-brand-700 transition">ุจุงุฒุงุฑ ูุญู</button>
                        <button onclick="switchTab('roadmap')" class="nav-btn px-3 py-2 rounded-md text-sm font-medium hover:bg-brand-700 transition">ููุดู ุฑุงู</button>
                    </div>
                </div>
                <!-- Mobile menu button stub -->
                <div class="-mr-2 flex md:hidden">
                    <button onclick="toggleMobileMenu()" class="inline-flex items-center justify-center p-2 rounded-md text-brand-200 hover:text-white hover:bg-brand-700 focus:outline-none">
                        โฐ
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-brand-700">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button onclick="switchTab('home')" class="block w-full text-right px-3 py-2 rounded-md text-base font-medium hover:bg-brand-600">ุฎุงูู</button>
                <button onclick="switchTab('simulation')" class="block w-full text-right px-3 py-2 rounded-md text-base font-medium hover:bg-brand-600">ุดุจูโุณุงุฒ ฺฉู ูพูู</button>
                <button onclick="switchTab('market')" class="block w-full text-right px-3 py-2 rounded-md text-base font-medium hover:bg-brand-600">ุจุงุฒุงุฑ ูุญู</button>
                <button onclick="switchTab('roadmap')" class="block w-full text-right px-3 py-2 rounded-md text-base font-medium hover:bg-brand-600">ููุดู ุฑุงู</button>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-7xl">

        <!-- SECTION 1: HOME / HERO -->
        <div id="home" class="tab-content active space-y-12">
            
            <!-- Hero Banner -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden grid md:grid-cols-2 gap-8 p-8 md:p-12 items-center">
                <div class="space-y-6">
                    <h1 class="text-4xl md:text-5xl font-black text-brand-900 leading-tight">
                        ุญูุธ ูุฏุฑุช ุฎุฑุฏ ุจุง <span class="text-brand-600">ฺฉุงูุง ูุงูุน</span>
                    </h1>
                    <p class="text-lg text-gray-600 leading-relaxed text-justify">
                        ุขุง ูฺฏุฑุงู ฺฉุงูุด ุงุฑุฒุด ุฑุงู ูุณุชุฏุ ุณุงูุงูู ยซููุจุงุฏููยป ุฑุงูฺฉุงุฑ ุงุณุช ฺฉู ูพูู ููุฏ ุดูุง ุฑุง ุจู ฺฉุงูุงูุง ุงุณุงุณ (ุจุฑูุฌุ ุญุจูุจุงุชุ ุฑูุบู) ุชุจุฏู ูโฺฉูุฏ. ุจูโุฌุง ูฺฏูุฏุงุฑ ูพูู ุจโุงุฑุฒุดุ "ุงุนุชุจุงุฑ ฺฉุงูุง" (CC) ุฐุฎุฑู ฺฉูุฏ ู ุฏุฑ ุดุจฺฉู ูุญู ููุณุงฺฏุงู ุฎูุฏ ูุจุงุฏูู ููุงุฏ.
                    </p>
                    <div class="flex flex-wrap gap-4">
                        <button onclick="switchTab('simulation')" class="bg-brand-600 text-white px-8 py-3 rounded-lg font-bold shadow-lg hover:bg-brand-700 hover:shadow-xl transition transform hover:-translate-y-1">
                            ุดุฑูุน ุดุจูโุณุงุฒ
                        </button>
                        <button onclick="scrollToId('features')" class="bg-brand-100 text-brand-800 px-8 py-3 rounded-lg font-bold border border-brand-300 hover:bg-brand-200 transition">
                            ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏุ
                        </button>
                    </div>
                </div>
                <div class="bg-brand-50 p-6 rounded-xl border-2 border-dashed border-brand-200 text-center">
                    <div class="text-6xl mb-4">โ๏ธ</div>
                    <h3 class="text-xl font-bold text-brand-800 mb-2">ุชุจุฏู ุฑุงู ุจู ุงุนุชุจุงุฑ ูพุงุฏุงุฑ</h3>
                    <p class="text-sm text-gray-500 mb-6">ูููุฏุงุฑ ูุฑุถ ุญูุธ ุงุฑุฒุด ุฏุฑ ถ ูุงู</p>
                    
                    <!-- Chart: Inflation Protection -->
                    <div class="chart-container mx-auto h-64">
                        <canvas id="inflationChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Features / Context -->
            <div id="features" class="grid md:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-brand-500 hover:shadow-lg transition">
                    <div class="text-4xl mb-4 text-center">๐ฆ</div>
                    <h3 class="text-xl font-bold text-brand-900 text-center mb-3">ุฐุฎุฑู ฺฉุงูุง</h3>
                    <p class="text-gray-600 text-sm text-justify">
                        ุจูโุฌุง ูพูู ููุฏุ ฺฉุงูุงูุง ุจุง ูุงูุฏฺฏุงุฑ ุจุงูุง (ูุงููุฏ ุจุฑูุฌ ู ูุงฺฉุงุฑูู) ุฑุง ุฏุฑ ุฎุงูู ูฺฏู ุฏุงุฑุฏ. ุณุณุชู ูุง ุงุฑุฒุด ูุญุธูโุง ุขููุง ุฑุง ูุญุงุณุจู ฺฉุฑุฏู ู ุจู ุดูุง ุงุนุชุจุงุฑ ูโุฏูุฏ.
                    </p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-brand-500 hover:shadow-lg transition">
                    <div class="text-4xl mb-4 text-center">๐ค</div>
                    <h3 class="text-xl font-bold text-brand-900 text-center mb-3">ูุจุงุฏูู ูุญู</h3>
                    <p class="text-gray-600 text-sm text-justify">
                        ุฏุฑ ุดุนุงุน ต ฺฉูููุชุฑ ุฎูุฏุ ููุณุงฺฏุงู ุฑุง ุจุงุจุฏ ฺฉู ุจู ฺฉุงูุง ุดูุง ูุงุฒ ุฏุงุฑูุฏ ุง ฺฉุงูุง ููุฑุฏ ูุงุฒ ุดูุง ุฑุง ุฏุงุฑูุฏ. ูุจุงุฏูู ุจุฏูู ูุงุฒ ุจู ูพูู ููุฏ.
                    </p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-brand-500 hover:shadow-lg transition">
                    <div class="text-4xl mb-4 text-center">๐ก๏ธ</div>
                    <h3 class="text-xl font-bold text-brand-900 text-center mb-3">ุงููุช ู ุงุนุชูุงุฏ</h3>
                    <p class="text-gray-600 text-sm text-justify">
                        ุงุญุฑุงุฒ ููุช ุจุง ฺฏูฺฏู ู ุณุณุชู ุงูุชุงุฒุฏู ุฏููุ ูุญุท ุงูู ุจุฑุง ุชุจุงุฏูุงุช ุงุฌุงุฏ ูโฺฉูุฏ. ููุชโฺฏุฐุงุฑ ุดูุงู ุจุฑ ุงุณุงุณ ูุฑุฎ ุฑูุฒ ุจุงุฒุงุฑ ุขููุงู.
                    </p>
                </div>
            </div>
        </div>

        <!-- SECTION 2: SIMULATION DASHBOARD -->
        <div id="simulation" class="tab-content space-y-8">
            <div class="bg-brand-50 border-l-4 border-brand-600 p-6 rounded-r-lg">
                <h2 class="text-2xl font-bold text-brand-900 mb-2">ุฏุงุดุจูุฑุฏ ุดุจูโุณุงุฒ ุฏุงุฑุง</h2>
                <p class="text-brand-800 text-justify">
                    ุฏุฑ ุงู ุจุฎุดุ ุดูุง ูโุชูุงูุฏ ูุญูู ฺฉุงุฑฺฉุฑุฏ ุณุณุชู ยซุงุนุชุจุงุฑ ฺฉุงูุงยป (CC) ุฑุง ุชุฌุฑุจู ฺฉูุฏ. ุชุตูุฑ ฺฉูุฏ ููุฏุงุฑ ฺฉุงูุง ุฎุฑุฏุงุฑ ฺฉุฑุฏูโุงุฏ. ุขููุง ุฑุง ุจู ูุณุช ุฏุงุฑุงโูุง ุฎูุฏ ุงุถุงูู ฺฉูุฏ ุชุง ุจุจูุฏ ฺฺฏููู ุงุฑุฒุด ุฑุงู ุขููุง ูุญุงุณุจู ุดุฏู ู ุจู ุงุนุชุจุงุฑ ุณุณุชู ุชุจุฏู ูโุดูุฏ. ุงู ุฏุงุดุจูุฑุฏ ุจู ุดูุง ฺฉูฺฉ ูโฺฉูุฏ ุชุง ููููู <strong>ุญูุธ ุงุฑุฒุด</strong> ุฑุง ุฏุฑ ุนูู ุฏุฑฺฉ ฺฉูุฏ. ุจุง ุฑูุฑุด ฺฉุฑุฏู ุตูุญูุ ููุฌูุฏ ุดูุง ููฺูุงู ุญูุธ ุฎูุงูุฏ ุดุฏ.
                </p>
            </div>

            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Add Asset Form -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 lg:col-span-1">
                    <h3 class="text-lg font-bold text-brand-800 mb-6 border-b pb-2">ุซุจุช ุฏุงุฑุง ุฌุฏุฏ</h3>
                    <form id="addAssetForm" class="space-y-4" onsubmit="event.preventDefault(); addAsset();">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ููุน ฺฉุงูุง</label>
                            <select id="assetType" class="w-full bg-gray-50 border border-gray-300 rounded-lg p-2.5 focus:ring-brand-500 focus:border-brand-500">
                                <option value="rice" data-price="1000000">ุจุฑูุฌ ุงุฑุงู (ฺฉููฺฏุฑู) - ฑ,ฐฐฐ,ฐฐฐ ุฑุงู</option>
                                <option value="lentils" data-price="850000">ุนุฏุณ ุฑุฒ (ฺฉููฺฏุฑู) - ธตฐ,ฐฐฐ ุฑุงู</option>
                                <option value="macaroni" data-price="450000">ูุงฺฉุงุฑูู (ุจุณุชู ตฐฐ ฺฏุฑู) - ดตฐ,ฐฐฐ ุฑุงู</option>
                                <option value="oil" data-price="650000">ุฑูุบู ุณุฑุฎโฺฉุฑุฏู (ูุชุฑ) - ถตฐ,ฐฐฐ ุฑุงู</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ููุฏุงุฑ / ุชุนุฏุงุฏ</label>
                            <input type="number" id="assetAmount" min="1" value="1" class="w-full bg-gray-50 border border-gray-300 rounded-lg p-2.5 focus:ring-brand-500 focus:border-brand-500">
                        </div>
                        
                        <div class="pt-4">
                            <button type="submit" class="w-full bg-brand-600 text-white font-bold py-3 rounded-lg hover:bg-brand-700 transition shadow-md flex justify-center items-center gap-2">
                                <span>โ</span> ุงูุฒูุฏู ุจู ุงูุจุงุฑ ูุฌุงุฒ
                            </button>
                        </div>
                    </form>
                    
                    <div class="mt-8 bg-brand-50 p-4 rounded-lg">
                        <h4 class="text-sm font-bold text-brand-800 mb-2">ูุฑุฎ ุชุจุฏู ุงูุฑูุฒ:</h4>
                        <p class="text-xs text-brand-600 mb-1">ูุฑ ฑฐฐ,ฐฐฐ ุฑุงู ุงุฑุฒุด ฺฉุงูุง = <strong>ฑ ูุงุญุฏ ุงุนุชุจุงุฑ (1 CC)</strong></p>
                        <p class="text-xs text-gray-500">ุจูโุฑูุฒุฑุณุงู ุดุฏู ุงุฒ: ุฏุฌโฺฉุงูุงุ ุงูู ฺฉูุฑูุด</p>
                    </div>
                </div>

                <!-- Assets Overview & Charts -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Stat Cards -->
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="bg-white p-4 rounded-xl shadow border-b-4 border-brand-400">
                            <p class="text-gray-500 text-xs mb-1">ูุฌููุน ุงุฑุฒุด ุฑุงู</p>
                            <p id="totalRial" class="text-2xl font-black text-gray-800">0</p>
                            <p class="text-xs text-gray-400">ุฑุงู</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow border-b-4 border-accent-green">
                            <p class="text-gray-500 text-xs mb-1">ููุฌูุฏ ุงุนุชุจุงุฑ (CC)</p>
                            <p id="totalCCDisplay" class="text-2xl font-black text-brand-600">0</p>
                            <p class="text-xs text-gray-400">ูุงุญุฏ ุงุนุชุจุงุฑ</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow border-b-4 border-blue-400 col-span-2 md:col-span-1">
                            <p class="text-gray-500 text-xs mb-1">ุชุนุฏุงุฏ ุงููุงู</p>
                            <p id="totalItems" class="text-2xl font-black text-gray-800">0</p>
                            <p class="text-xs text-gray-400">ููู ฺฉุงูุง</p>
                        </div>
                    </div>

                    <!-- Charts Area -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-xl shadow-lg">
                            <h4 class="text-sm font-bold text-gray-700 mb-4 text-center">ุชุฑฺฉุจ ุฏุงุฑุงโูุง</h4>
                            <div class="chart-container">
                                <canvas id="portfolioChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-xl shadow-lg">
                            <h4 class="text-sm font-bold text-gray-700 mb-4 text-center">ูุณุช ููุฌูุฏ ุงูุจุงุฑ</h4>
                            <div class="overflow-y-auto h-[300px] pr-2 custom-scrollbar">
                                <table class="w-full text-sm text-right">
                                    <thead class="bg-gray-50 text-gray-600 sticky top-0">
                                        <tr>
                                            <th class="p-2">ฺฉุงูุง</th>
                                            <th class="p-2">ููุฏุงุฑ</th>
                                            <th class="p-2">ุงุฑุฒุด (CC)</th>
                                            <th class="p-2">ุญุฐู</th>
                                        </tr>
                                    </thead>
                                    <tbody id="assetsTableBody" class="divide-y divide-gray-100">
                                        <!-- Rows added by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 3: MARKETPLACE -->
        <div id="market" class="tab-content space-y-8">
            <div class="bg-white p-8 rounded-2xl shadow-sm text-center border border-gray-200">
                <h2 class="text-2xl font-bold text-brand-900 mb-4">ุจุงุฒุงุฑ ูุญู (ููููู ุขุฒูุงุด)</h2>
                <p class="text-gray-600 max-w-2xl mx-auto mb-8">
                    ุฏุฑ ุงู ุจุฎุด ูโุชูุงูุฏ ฺฉุงูุงูุง ููุฌูุฏ ุฏุฑ ูุญูู ุฎูุฏ (ุดุนุงุน ต ฺฉูููุชุฑ) ุฑุง ุฌุณุชุฌู ฺฉูุฏ. ูุถุนุช ุงุนุชุจุงุฑ CC ุดูุง ุงุฒ ุจุฎุด ุดุจูโุณุงุฒ ุฎูุงูุฏู ูโุดูุฏ ู ูุดุงู ูโุฏูุฏ ุขุง ูโุชูุงูุฏ ุงู ูุจุงุฏูุงุช ุฑุง ุงูุฌุงู ุฏูุฏ ุง ุฎุฑ.
                </p>

                <!-- Search Bar - ADDED filterMarketplace function calls -->
                <div class="flex flex-col md:flex-row gap-4 max-w-3xl mx-auto mb-10">
                    <input type="text" id="marketSearchInput" onkeyup="filterMarketplace()" placeholder="ุฌุณุชุฌู ฺฉุงูุง (ูุซูุงู ุนุฏุณ)..." class="flex-grow bg-gray-50 border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none">
                    <select id="marketAreaSelect" class="bg-gray-50 border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-brand-500 outline-none">
                        <option>ุชูุงู ูุญููโูุง</option>
                        <option>ุชูุฑุงู - ูุงุฑูฺฉ</option>
                        <option>ุชูุฑุงู - ุชูุฑุงูโูพุงุฑุณ</option>
                        <option>ุชูุฑุงู - ูพุฑูุฒ</option>
                    </select>
                    <button onclick="filterMarketplace()" class="bg-brand-600 text-white px-6 py-3 rounded-lg hover:bg-brand-700 font-bold transition">ุฌุณุชุฌู</button>
                </div>

                <!-- Market Grid -->
                <div id="marketplaceGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 text-right">
                    <!-- Dynamic Market Items rendered by JS -->
                </div>
            </div>
        </div>

        <!-- SECTION 4: ROADMAP -->
        <div id="roadmap" class="tab-content space-y-8">
            <div class="bg-white p-8 rounded-2xl shadow-sm">
                <h2 class="text-2xl font-bold text-brand-900 mb-6 border-b pb-4">ููุดู ุฑุงู ุชูุณุนู ู ููุงุณโูพุฐุฑ</h2>
                <div class="relative border-r-4 border-brand-200 mr-4 space-y-12">
                    
                    <!-- Phase 0 -->
                    <div class="relative pr-8">
                        <div class="absolute -right-3 top-1 w-6 h-6 bg-brand-600 rounded-full border-4 border-white shadow"></div>
                        <h3 class="text-xl font-bold text-gray-800">ูุงุฒ ฐ: ุทุฑุงุญ (ฑ ูุงู)</h3>
                        <p class="text-sm text-brand-600 font-bold mb-2">ูุถุนุช: ุฏุฑ ุญุงู ุงูุฌุงู</p>
                        <div class="bg-gray-50 p-4 rounded-lg text-sm text-gray-600 space-y-2">
                            <p>โ ุทุฑุงุญ MVP ู ุฏุชุงุจุณ MongoDB</p>
                            <p>โ ูพุงุฏูโุณุงุฒ ุณุณุชู ุงุญุฑุงุฒ ููุช ฺฏูฺฏู</p>
                            <p>๐ง ุขูุงุฏูโุณุงุฒ ุฑุงุจุท ฺฉุงุฑุจุฑ ุจุฑุง ฑฐฐ ฺฉุงุฑุจุฑ ุขุฒูุงุด</p>
                        </div>
                    </div>

                    <!-- Phase 1 -->
                    <div class="relative pr-8 opacity-75">
                        <div class="absolute -right-3 top-1 w-6 h-6 bg-gray-300 rounded-full border-4 border-white"></div>
                        <h3 class="text-xl font-bold text-gray-800">ูุงุฒ ฑ: ูพุงููุช ูุญู (ฒ ูุงู)</h3>
                        <div class="bg-gray-50 p-4 rounded-lg text-sm text-gray-600 space-y-2 mt-2">
                            <p>๐น ุชุณุช ุฏุฑ ฺฉ ูุญูู ฺฉูฺฺฉ (ตฐ ฺฉุงุฑุจุฑ)</p>
                            <p>๐น ูุฑุฎโฺฏุฐุงุฑ ุฏุณุช ุงููุงู ูุฑุฌุน</p>
                            <p>๐น ูุฏู: ฑฐฐ ุชุจุงุฏู ูููู</p>
                        </div>
                    </div>

                    <!-- Phase 2 -->
                    <div class="relative pr-8 opacity-50">
                        <div class="absolute -right-3 top-1 w-6 h-6 bg-gray-200 rounded-full border-4 border-white"></div>
                        <h3 class="text-xl font-bold text-gray-800">ูุงุฒ ฒ: ุชูุณุนู ู ุงุชููุงุณูู (ณ ูุงู)</h3>
                        <div class="bg-gray-50 p-4 rounded-lg text-sm text-gray-600 space-y-2 mt-2">
                            <p>๐น ุฑุจุงุชโูุง ููุชโฺฏุฐุงุฑ ุฎูุฏฺฉุงุฑ (ุงุณฺฉุฑูพูฺฏ)</p>
                            <p>๐น ฺุช ุฏุงุฎู ู ุณุณุชู ุงูุชุงุฒุฏู ฺฉุงูู</p>
                            <p>๐น ฺฏุณุชุฑุด ุจู ต ููุทูู</p>
                        </div>
                    </div>

                    <!-- Phase 3 -->
                    <div class="relative pr-8 opacity-50">
                        <div class="absolute -right-3 top-1 w-6 h-6 bg-gray-200 rounded-full border-4 border-white"></div>
                        <h3 class="text-xl font-bold text-gray-800">ูุงุฒ ณ: ุฑุดุฏ ู ุชุซุจุช (ถ ูุงู)</h3>
                        <div class="bg-gray-50 p-4 rounded-lg text-sm text-gray-600 space-y-2 mt-2">
                            <p>๐น ตฐฐฐ ฺฉุงุฑุจุฑ ูุนุงู</p>
                            <p>๐น ุชุซุจุช CC ุจู ุนููุงู ุดุงุฎุต ูุญู</p>
                            <p>๐น ุงูุฒูุฏู ูุญุตููุงุช ุตูุงุน ุฏุณุช</p>
                        </div>
                    </div>

                </div>

                <!-- Tech Stack Footer -->
                <div class="mt-12 pt-8 border-t border-gray-200">
                    <h4 class="text-lg font-bold text-brand-800 mb-4 text-center">ุฒุฑุณุงุฎุช ูู ูพุดููุงุฏ</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center text-sm">
                        <div class="bg-brand-50 p-3 rounded text-brand-900 font-bold">React / Next.js</div>
                        <div class="bg-brand-50 p-3 rounded text-brand-900 font-bold">Node.js / Express</div>
                        <div class="bg-brand-50 p-3 rounded text-brand-900 font-bold">MongoDB</div>
                        <div class="bg-brand-50 p-3 rounded text-brand-900 font-bold">Google OAuth</div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-brand-900 text-brand-200 py-6 mt-8">
        <div class="container mx-auto px-4 text-center text-sm">
            <p class="mb-2">ุทุฑุญ ุฌุงูุน ุณุงูุงูู ูพุงุงูพุง ฺฉุงูุง ูุญู (ููุจุงุฏูู)</p>
            <p class="opacity-70">ุทุฑุงุญ ุดุฏู ุจุฑุง ุญูุธ ูุฏุฑุช ุฎุฑุฏ ุฎุงููุงุฑ</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- Data & State ---
        // Mock Prices (Rial)
        const prices = {
            rice: 1000000,
            lentils: 850000,
            macaroni: 450000,
            oil: 650000
        };
        
        const labels = {
            rice: 'ุจุฑูุฌ',
            lentils: 'ุนุฏุณ',
            macaroni: 'ูุงฺฉุงุฑูู',
            oil: 'ุฑูุบู'
        };

        // Mock Marketplace Items
        const marketplaceItems = [
            { id: 1, name: 'ฑฐ ฺฉููฺฏุฑู ุจุฑูุฌ ุทุงุฑู', icon: '๐', distance: 'ตฐฐ ูุชุฑ', rialValue: 10000000, ccRequired: 100.0, type: 'barter', rating: 4.8, deals: 12 },
            { id: 2, name: 'ต ุจุณุชู ูุงฺฉุงุฑูู', icon: '๐', distance: 'ฑ.ฒ ฺฉูููุชุฑ', rialValue: 2250000, cashPrice: 2000000, type: 'cash', rating: 5.0, deals: 5 },
            { id: 3, name: 'ณ ฺฉููฺฏุฑู ุนุฏุณ', icon: '๐ฅซ', distance: 'ฒฐฐ ูุชุฑ', rialValue: 2550000, ccRequired: 25.5, type: 'barter', rating: 0, deals: 0 },
            { id: 4, name: 'ฒ ูุชุฑ ุฑูุบู ุณุฑุฎโฺฉุฑุฏู', icon: '๐ป', distance: 'ธฐฐ ูุชุฑ', rialValue: 1300000, ccRequired: 13.0, type: 'barter', rating: 4.2, deals: 2 },
            { id: 5, name: 'ต ฺฉููฺฏุฑู ุจุฑูุฌ ูุงุดู', icon: '๐พ', distance: 'ดฐฐ ูุชุฑ', rialValue: 5500000, ccRequired: 55.0, type: 'barter', rating: 4.9, deals: 25 },
        ];

        // User Assets State
        let assets = [];
        let totalCC = 0;
        let portfolioChartInstance = null;
        let inflationChartInstance = null;

        // --- Persistence Logic ---
        function saveAssets() {
            localStorage.setItem('mobadeleh_assets', JSON.stringify(assets));
        }

        function loadAssets() {
            const storedAssets = localStorage.getItem('mobadeleh_assets');
            if (storedAssets) {
                assets = JSON.parse(storedAssets);
            }
        }

        // --- Core Calculation ---
        function calculateTotals() {
            let rial = 0;
            let cc = 0;
            assets.forEach(asset => {
                rial += asset.rialValue;
                cc += asset.ccValue;
            });
            totalCC = cc;
            return { totalRial: rial, totalCC: cc, totalItems: assets.length };
        }

        // --- Navigation Logic ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            // Re-render charts and dynamic content when switching tabs
            if (tabId === 'home') renderInflationChart();
            if (tabId === 'simulation') renderPortfolioChart();
            // Market render is now handled by updateDashboard and filterMarketplace, 
            // but we call it here to ensure proper initial state after tab switch if state hasn't changed.
            if (tabId === 'market') filterMarketplace(); 

            document.getElementById('mobile-menu').classList.add('hidden');
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        function scrollToId(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- Chart 1: Inflation Protection (Home) ---
        function renderInflationChart() {
            const ctx = document.getElementById('inflationChart').getContext('2d');
            if (inflationChartInstance) inflationChartInstance.destroy();

            inflationChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['ูุงู ฑ', 'ูุงู ฒ', 'ูุงู ณ', 'ูุงู ด', 'ูุงู ต', 'ูุงู ถ'],
                    datasets: [{
                        label: 'ุงุฑุฒุด ูุงูุน ูพูู ููุฏ (ุจุง ุชูุฑู ดฐูช)',
                        data: [100, 96, 92, 88, 85, 82], // Simulated loss
                        borderColor: '#f87171', // Red
                        backgroundColor: 'rgba(248, 113, 113, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'ุงุฑุฒุด ุณุจุฏ ฺฉุงูุง (ููุจุงุฏูู)',
                        data: [100, 103, 107, 112, 116, 120], // Simulated keeping pace with inflation
                        borderColor: '#4ade80', // Green
                        backgroundColor: 'rgba(74, 222, 128, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw + ' ูุงุญุฏ';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: { display: true, text: 'ุดุงุฎุต ูุฏุฑุช ุฎุฑุฏ' }
                        }
                    }
                }
            });
        }

        // --- Chart 2: Portfolio Composition (Simulation) ---
        function renderPortfolioChart() {
            const ctx = document.getElementById('portfolioChart').getContext('2d');
            if (portfolioChartInstance) portfolioChartInstance.destroy();

            // Aggregate data for chart
            const dataMap = {};
            assets.forEach(a => {
                if(!dataMap[a.type]) dataMap[a.type] = 0;
                dataMap[a.type] += a.rialValue;
            });

            const chartLabels = Object.keys(dataMap).map(k => labels[k]);
            const chartData = Object.values(dataMap);
            const chartColors = ['#aa7e40', '#d1b278', '#c59a53', '#896136'];

            if (chartData.length === 0) {
                // Empty state
                portfolioChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['ุฎุงู'],
                        datasets: [{ data: [1], backgroundColor: ['#e5e7eb'] }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
                return;
            }

            portfolioChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        data: chartData,
                        backgroundColor: chartColors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    return ' ' + value.toLocaleString() + ' ุฑุงู';
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- Logic: Add Asset ---
        function addAsset() {
            const typeSelect = document.getElementById('assetType');
            const amountInput = document.getElementById('assetAmount');
            
            const type = typeSelect.value;
            const amount = parseFloat(amountInput.value);
            const unitPrice = parseFloat(typeSelect.options[typeSelect.selectedIndex].getAttribute('data-price'));
            
            if (amount <= 0 || isNaN(amount)) return;

            const totalRial = amount * unitPrice;
            const ccValue = totalRial / 100000; // 1 CC = 100,000 Rials

            // Add to state
            assets.push({
                id: Date.now(),
                type: type,
                amount: amount,
                unitPrice: unitPrice,
                rialValue: totalRial,
                ccValue: ccValue
            });

            // Update UI & Persist
            updateDashboard();
            saveAssets();
            
            // Reset form
            amountInput.value = 1;
        }

        // --- Logic: Remove Asset ---
        function removeAsset(id) {
            assets = assets.filter(a => a.id !== id);
            // Update UI & Persist
            updateDashboard();
            saveAssets();
        }

        // --- Update Dashboard UI (now includes marketplace sync) ---
        function updateDashboard() {
            const tableBody = document.getElementById('assetsTableBody');
            tableBody.innerHTML = '';

            const totals = calculateTotals();

            if (assets.length === 0) {
                tableBody.innerHTML = '<tr class="text-gray-400 italic text-center"><td colspan="4" class="p-4">ูููุฒ ฺฉุงูุง ุซุจุช ูุดุฏู ุงุณุช.</td></tr>';
            } else {
                assets.forEach(asset => {
                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-gray-50 transition";
                    tr.innerHTML = `
                        <td class="p-2 font-medium">${labels[asset.type]}</td>
                        <td class="p-2">${asset.amount}</td>
                        <td class="p-2 font-bold text-brand-700">${asset.ccValue.toFixed(1)}</td>
                        <td class="p-2"><button onclick="removeAsset(${asset.id})" class="text-red-400 hover:text-red-600 font-bold">ร</button></td>
                    `;
                    tableBody.appendChild(tr);
                });
            }

            // Update Totals Display
            document.getElementById('totalRial').innerText = totals.totalRial.toLocaleString();
            document.getElementById('totalCCDisplay').innerText = totals.totalCC.toFixed(1);
            document.getElementById('totalItems').innerText = totals.totalItems;

            // Update Chart
            renderPortfolioChart();
            
            // โญ๏ธ IMPORTANT FIX: Update marketplace immediately to reflect new credit
            // It reads the current search query to keep the filter active.
            const currentQuery = document.getElementById('marketSearchInput')?.value || '';
            renderMarketplace(currentQuery); 
        }
        
        // --- Marketplace Logic (Now includes filtering) ---
        function filterMarketplace() {
            const query = document.getElementById('marketSearchInput').value.toLowerCase().trim();
            // We can also include logic for area filtering here if needed, but for now, just text search.
            renderMarketplace(query);
        }

        function renderMarketplace(query = '') {
            const grid = document.getElementById('marketplaceGrid');
            grid.innerHTML = '';
            
            const currentCC = totalCC; // Get the live/cached CC balance

            // 1. Filtering Logic
            const filteredItems = marketplaceItems.filter(item => {
                if (!query) return true; // Show all if no query
                // Simple check if the item name contains the query (case-insensitive)
                return item.name.toLowerCase().includes(query.toLowerCase());
            });

            if (filteredItems.length === 0) {
                grid.innerHTML = '<div class="md:col-span-3 text-center text-gray-500 p-8 bg-gray-50 rounded-xl shadow-inner">ฺฉุงูุง ุจุง ุงู ุนููุงู ูพุฏุง ูุดุฏ.</div>';
                return;
            }


            filteredItems.forEach(item => {
                const isBarter = item.type === 'barter';
                const canAfford = isBarter && item.ccRequired <= currentCC;
                
                let statusTag, actionButton, actionColor, actionText;

                if (isBarter) {
                    if (canAfford) {
                        // โญ๏ธ FIX: Green status when affordable
                        statusTag = '<div class="absolute top-0 left-0 bg-accent-green text-white text-xs px-2 py-1 rounded-br-lg z-10">ุงุนุชุจุงุฑ ฺฉุงู | ูุจุงุฏูู ุจุง ฺฉุงูุง</div>';
                        actionButton = `<button class="text-brand-600 hover:text-brand-800 text-sm font-bold border border-brand-200 hover:border-brand-600 px-3 py-1 rounded transition">ุฏุฑุฎูุงุณุช ูุจุงุฏูู</button>`;
                        actionColor = 'text-brand-700';
                        actionText = `${item.ccRequired.toFixed(1)} CC`;
                    } else {
                        // โญ๏ธ FIX: Red status when insufficient credit
                        const creditNeeded = (item.ccRequired - currentCC);
                        statusTag = `<div class="absolute top-0 left-0 bg-red-500 text-white text-xs px-2 py-1 rounded-br-lg z-10">ฺฉุณุฑ ุงุนุชุจุงุฑ (${creditNeeded.toFixed(1)} CC)</div>`;
                        actionButton = `<button disabled class="text-gray-400 bg-gray-100 text-sm font-bold border border-gray-200 px-3 py-1 rounded cursor-not-allowed">ุงุนุชุจุงุฑ ฺฉุงู ูุณุช</button>`;
                        actionColor = 'text-red-500';
                        actionText = `${item.ccRequired.toFixed(1)} CC`;
                    }
                } else { // Cash item
                    statusTag = '<div class="absolute top-0 left-0 bg-accent-blue text-white text-xs px-2 py-1 rounded-br-lg z-10">ูุฑูุด ููุฏ</div>';
                    actionButton = `<button class="text-accent-blue hover:text-blue-700 text-sm font-bold border border-brand-200 hover:border-accent-blue px-3 py-1 rounded transition">ฺุช ุจุง ูุฑูุดูุฏู</button>`;
                    actionColor = 'text-gray-700';
                    actionText = `${item.cashPrice.toLocaleString()} ุฑุงู`;
                }

                let ratingDisplay;
                if (item.rating > 0) {
                    ratingDisplay = `<div class="flex items-center gap-1">
                                <span class="text-yellow-400">โ</span>
                                <span class="text-sm font-bold text-gray-700">${item.rating.toFixed(1)}</span>
                                <span class="text-xs text-gray-400">(${item.deals} ูุนุงููู)</span>
                            </div>`;
                } else {
                    ratingDisplay = `<div class="flex items-center gap-1">
                                <span class="text-gray-300">โ</span>
                                <span class="text-xs text-gray-400">(ฺฉุงุฑุจุฑ ุฌุฏุฏ)</span>
                            </div>`;
                }

                const cardHTML = `
                    <div class="bg-white border border-gray-200 rounded-xl p-5 hover:shadow-xl transition group relative overflow-hidden text-right">
                        ${statusTag}
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-lg text-gray-800">${item.name}</h3>
                                <p class="text-sm text-gray-500">ูุงุตูู: ${item.distance}</p>
                            </div>
                            <div class="text-2xl">${item.icon}</div>
                        </div>
                        <div class="bg-brand-50 p-3 rounded-lg mb-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-600">ุงุฑุฒุด ุฑูุฒ:</span>
                                <span class="font-bold text-brand-700">${item.rialValue.toLocaleString()} ุฑุงู</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">${isBarter ? 'ุงุนุชุจุงุฑ ููุฑุฏ ูุงุฒ:' : 'ููุช ูพุดููุงุฏ:'}</span>
                                <span class="font-bold ${actionColor}">${actionText}</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            ${ratingDisplay}
                            ${actionButton}
                        </div>
                    </div>
                `;
                grid.insertAdjacentHTML('beforeend', cardHTML);
            });
        }


        // --- Initialization ---
        window.addEventListener('load', () => {
            loadAssets();
            // updateDashboard calls calculateTotals, renderPortfolioChart, and renderMarketplace
            updateDashboard(); 
            renderInflationChart();
        });

    </script>
</body>
</html>
